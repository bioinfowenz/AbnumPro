<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Material Dash</title>
    <!-- plugins:css -->
    <link rel="stylesheet"
      href="../assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../assets/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet"
      href="../assets/vendors/flag-icon-css/css/flag-icon.min.css">
    <link rel="stylesheet"
      href="../assets/vendors/jvectormap/jquery-jvectormap.css">
    <!-- End plugin css for this page -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="../assets/css/demo/style.css">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="../assets/images/favicon.png" />
    <link href="../assets/bootstrap/css/docs.css"
      rel="stylesheet">
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.css" />
    <script
      src="../assets/bootstrap/js/bootstrap.js"></script>
  </head>
  <body>
    <script src="../assets/js/preloader.js"></script>
    <div class="body-wrapper">
      <!-- partial:partials/_sidebar.html -->
      <aside
        class="mdc-drawer mdc-drawer--dismissible mdc-drawer--open">
        <div>
          <div class="mdc-drawer__header">
            <a href="index.html" class="brand-logo">
              <img src="../assets/images/logo.svg" alt="logo">
            </a>
          </div>
          <div class="mdc-drawer__content">
            <!-- <div class="user-info">
            <p class="name">Clyde Miles</p>
            <p class="email">clydemiles@elenor.us</p>
          </div> -->
            <div class="mdc-list-group">
              <nav class="mdc-list mdc-drawer-menu">
                <div class="mdc-list-item mdc-drawer-item">
                  <a class="mdc-drawer-link" href="index.html">
                    <i
                      class="material-icons mdc-list-item__start-detail mdc-drawer-item-icon"
                      aria-hidden="true">home</i>
                    主页
                  </a>
                </div>
                <div class="mdc-list-item mdc-drawer-item">
                  <a class="mdc-drawer-link" href="number.html">
                    <i
                      class="material-icons mdc-list-item__start-detail mdc-drawer-item-icon"
                      aria-hidden="true">track_changes</i>
                    抗体序列编号
                  </a>
                </div>
                <div class="mdc-list-item mdc-drawer-item">
                  <a class="mdc-drawer-link active" href="cdr.html">
                    <i
                      class="material-icons mdc-list-item__start-detail mdc-drawer-item-icon"
                      aria-hidden="true">dashboard</i>
                    抗体互补决定区预测
                  </a>
                </div>
                <div class="mdc-list-item mdc-drawer-item">
                  <a class="mdc-drawer-link" href="abr.html">
                    <i
                      class="material-icons mdc-list-item__start-detail mdc-drawer-item-icon"
                      aria-hidden="true">pages</i>
                    抗体抗原结合区域预测
                  </a>
                </div>

              </nav>
            </div>

          </div>
        </div>
      </aside>
      <!-- partial -->
      <div class="main-wrapper mdc-drawer-app-content">
        <!-- partial:partials/_navbar.html -->

        <!-- partial -->
        <div class="page-wrapper mdc-toolbar-fixed-adjust">
          <main class="content-wrapper">
            <div class="mdc-layout-grid">
              <div class="mdc-layout-grid__inner">
                <div
                  style="background-image: radial-gradient(circle at center, #ebc0fd 0%, #ffffff 100%);"
                  class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
                  <div class="mdc-card main ">
                    <div>
                      <h1 class="text-center">抗体互补决定区预测</h1>
                      <p>可以选择合适的方案获取序列的各个互补决定区（CDR）和框架区（Fr）。Kabat定义方案：基于序列可变性（variability），使用最为广泛，但是与结构不一定对应。

                        Chothia定义方案：基于结构loop区的位置。

                        Contact
                        定义方案：基于现有的抗体复合物晶体结构数据。</p>
                    </div>
                    <div class="form-group">
                      <!-- <label for="exampleTextarea">多行文本框</label> -->
                      <textarea class="form-control" id="sequence"
                        placeholder="请输入抗体序列"
                        rows="5"></textarea>
                      <div style="margin-top: 20px;">
                        <span>或者上传抗体序列组成的fasta文件</span>
                      </div>
                      <div style="margin-top: 10px;">
                        <button class='btn btn-block btn-light py-1'
                          id="fastaUpload">请选择fasta文件
                        </button>
                        <span id="fileName"></span>
                        <input type='hidden' id='filePath' placeholder='Path' />

                      </div>
                      <div style="margin-top: 20px;">
                        <div class="form-check form-check-inline">
                          <p form-check-inline>定义方案</p>
                        </div>
                        <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio"
                            name="numberSchema" id="Kabat"
                            value="Kabat" checked>
                          <label class="form-check-label"
                            for="Kabat">Kabat</label>
                        </div>
                        <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio"
                            name="numberSchema" id="chothia"
                            value="chothia">
                          <label class="form-check-label"
                            for="chothia">chothia</label>
                        </div>
                        <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio"
                            name="numberSchema" id="Imgt"
                            value="Imgt">
                          <label class="form-check-label"
                            for="Imgt">Imgt</label>
                        </div>
                        <!-- <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio"
                            name="numberSchema" id="Contact"
                            value="Contact">
                          <label class="form-check-label"
                            for="Contact">Contact</label>
                        </div> -->

                      </div>
                      <div>
                        <button type="button" class="btn btn-info" id="example"
                          style="width: 100px; margin-left: 25px; margin-right: 50px;">示例</button>
                        <button type="button" class="btn btn-warning" id="clear"
                          style="width: 100px; margin-left: 25px; margin-right: 50px;">清除</button>
                        <button type="button" class="btn btn-success"
                          id="submit"
                          style="width: 100px; margin-left: 25px; margin-right: 50px;">提交</button>
                      </div>

                    </div>

                  </div>
                </div>
              </div>
            </div>
          </main>

        </div>
        <div id="liveAlertPlaceholder"></div>
      </div>
    </div>
    <!-- plugins:js -->
    <script src="../assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page-->
    <script src="../assets/vendors/chartjs/Chart.min.js"></script>
    <script
      src="../assets/vendors/jvectormap/jquery-jvectormap.min.js"></script>
    <script
      src="../assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <!-- End plugin js for this page-->
    <!-- inject:js -->
    <script src="../assets/js/material.js"></script>
    <script src="../assets/js/misc.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <script src="../assets/js/dashboard.js"></script>
    <!-- End custom js for this page-->

  </body>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
    // 获取按钮元素
    var exampleButton = document.getElementById("example");
    var sequenceInput = document.getElementById("sequence");
    var clearButton = document.getElementById("clear");
    var submitButton = document.getElementById("submit");
    var schema = document.getElementsByName("numberSchema")
    var fileButton = document.getElementById("fastaUpload")
    var fileName = document.getElementById("fileName")
    var filePath = document.getElementById("filePath")
    fileButton.addEventListener('click',function(){
      window.pywebview.api.selectFastaFile().then(x=>{
        
          if (x) {
            filePath.value = x[0]
            var myPath = x[0]
            console.log(x)
            var fileArr = myPath.split("\\")
            console.log(x)
            console.log(fileArr)
            fileName.textContent = fileArr[fileArr.length-1]
            console.log(x)
              // window.pywebview.api.triggerCreateThumbs(x).then(outDir=>{
                  
              // })
          }
      }).catch(err=>alert('请选择正确的文件', 'success'))

    })
    // 添加点击事件监听器
    exampleButton.addEventListener("click", function() {
      // 在按钮点击时执行的操作
      // console.log("按钮被点击了！");
      var heavy_type = ">3OAU-H"
      var heavy_seq = "EVQLVESGGGLVKAGGSLRLSCGVSNFRISAHTMNWVRRVPGGGLEWVASISTSSTYRDYADAVKGRFTVSRDDLEDFVYLQMHKMRVEDTAIYYCARKGSDRLSDNDPFDAWGPGTVVTVSPASTKGPSVFPLAPSSKSTSGGTAALGCLVKDYFPEPVTVSWNSGALTSGVHTFPAVLQSSGLYSLSSVVTVPSSSLGTQTYICNVNHKPSNTKVDKKVEPKS"
      var light_type = ">1FBI-L"
      var light_seq = "DIQMTQTTSSLSASLGDRVTISCRASQDISNYLNWYQKKPDGTVKLLIYYTSRLHSGVPSRFSGSGSGTDYSLTIRNLEQEDIATYFCQQGYTLPYTFGGGTKLEIKRADAAPTVSIFPPSSEQLTSGGASVVCFLNNFYPKDINVKWKIDGSERQNGVLNSWTDQDSKDSTYSMSSTLTLTKDEYERHNSYTCEATHKTSTSPIVKSFNRNEC"
      var example_str = heavy_type + "\n" + heavy_seq + "\n" + light_type + "\n" + light_seq
      sequenceInput.value = example_str
      schema[0].checked=true

      // 你可以在这里编写更多的 JavaScript 代码来响应按钮点击事件
    });
    clearButton.addEventListener("click", function() {
      // 在按钮点击时执行的操作
      // console.log("按钮被点击了！");
      sequenceInput.value = ""
      schema[0].checked=true

      // 你可以在这里编写更多的 JavaScript 代码来响应按钮点击事件
    });
    submitButton.addEventListener("click", function() {
      // 在按钮点击时执行的操作
      // console.log("按钮被点击了！");
      var sequenceValue = sequenceInput.value
      var schemaValue
      for (var i = 0; i < schema.length; i++) {
        if (schema[i].checked) {
          schemaValue = schema[i].value;
          break;
        }
      }
      console.log(schemaValue)
      console.log("unsubmit")
      if(sequenceValue==""){
        if(filePath.value==""){
          alert("请输入序列","warning")
          return;
        }else{
          console.log("submit")
          
         
          window.pywebview.api.getCdrFile(filePath.value,schemaValue) // 将数据发送给 Flask 后端
        .then(function(response) {
          console.log('后端回复：', response);
          localStorage.setItem('cdr_results',JSON.stringify(response))
          window.location.href = 'cdr_result.html'
        })
        .catch(function(error) {
          alert("请输入正确序列","danger")
        });
          
        };     
      }else{
        window.pywebview.api.getCdrMessage(sequenceValue,schemaValue) // 将数据发送给 Flask 后端
        .then(function(response) {
          console.log('后端回复：', response);
          localStorage.setItem('cdr_results',JSON.stringify(response))
          window.location.href = 'cdr_result.html'
        })
        .catch(function(error) {
          alert("请输入正确序列","danger")
        });
      } 
                    // 你可以在这里编写更多的 JavaScript 代码来响应按钮点击事件
      });
    });
    // submitButton.addEventListener("click", function() {
    //   // 在按钮点击时执行的操作
    //   // console.log("按钮被点击了！");
    //   var sequenceValue = sequenceInput.value
    //   var schemaValue
    //   for (var i = 0; i < schema.length; i++) {
    //     if (schema[i].checked) {
    //       schemaValue = schema[i].value;
    //       break;
    //     }
    //   }
    //   console.log(schemaValue)

    //   window.pywebview.api.getCdrMessage(sequenceValue,schemaValue) // 将数据发送给 Flask 后端
    //     .then(function(response) {
    //       console.log('后端回复：', response);
    //       localStorage.setItem('cdr_results',JSON.stringify(response))
    //       window.location.href = 'cdr_result.html'
    //     })
    //     .catch(function(error) {
    //       console.error('发生错误：', error);
    //     });
    //                 // 你可以在这里编写更多的 JavaScript 代码来响应按钮点击事件
    //   });

//   function sendPostRequest() {
//     var xhr = new XMLHttpRequest();
//     var url = '你的目标URL';
//     var params = '参数1=值1&参数2=值2'; // 根据你的需求设置参数

//     xhr.open('POST', url, true);
//     xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

//     xhr.onreadystatechange = function() {
//       if (xhr.readyState === 4 && xhr.status === 200) {
//         // 请求成功，处理响应数据
//         alert(xhr.responseText);
//       }
//     };
    
//     xhr.send(params);
//   }
// function sendGetRequest(){
//   var xhr = new XMLHttpRequest();
//   var url = 'getNumber';
  
//   xhr.open('GET', url, true);
  
//   xhr.onreadystatechange = function() {
//     if (xhr.readyState === 4 && xhr.status === 200) {
//       // 请求成功，处理响应数据
//       alert(xhr.responseText);
//     }
//   };
  
//   xhr.send();
// }
const alertPlaceholder = document.getElementById('liveAlertPlaceholder');

  const alert = (message, type) => {
  const wrapper = document.createElement('div');
  wrapper.classList.add('position-fixed', 'top-0', 'start-50', 'translate-middle-x');
  wrapper.style.zIndex = '1000'; // 控制层叠顺序

  wrapper.innerHTML = `
    <div class="alert alert-${type} alert-dismissible infowidth" role="alert">
      <div>${message}</div>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  `;

  alertPlaceholder.appendChild(wrapper);

  // 设置警告框显示时间
  // setTimeout(() => {
  //   alertPlaceholder.removeChild(wrapper);
  // }, 5000); // 5000 毫秒后自动关闭警告框
};

  </script>
</html>